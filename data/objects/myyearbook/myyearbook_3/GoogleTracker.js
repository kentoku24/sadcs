/**
*
* Example of JS snippet added to Ad Server:
* <code>
*   <script type="text/javascript">
*   var name = 'myb_1x1_pledgewall_promo';
*   var url = '%%CLICK_URL_UNESC%%http://www.nike.com/nikeos/p/nike/en_US/?';
*   var iframeElement = document.createElement('iframe');
*   window.document.body.appendChild(iframeElement);
*   iframeElement.setAttribute('height', '1px' );
*   iframeElement.setAttribute('width', '1px' );
*   iframeElement.setAttribute('border', '0' );
*   iframeElement.setAttribute('frameborder', '0' );
*   iframeElement.setAttribute('scrolling', 'no' );
*   iframeElement.setAttribute('src','http://wwallace.project1.mybxxx.com/apps/googletracker/setclick?type=click&name='+name+'&clickurl='+escape(url ) );
*   </script>
* </code>
*
* googletracker/setclick adds the following JS to the page:
*  - window.parent.parent.GoogleTracker.setClickURL( $_GET['name'], $_GET['clickurl'] )
* 
*/

var GoogleTracker = {
  clickURL : {},

  /*
  * Adds passed in url to clickURL object using tag as a label for the url
  *
  * tag param comes from variable 'name' in js snippet added to Ad Server
  * tag is used as key in associative array which gets accessed in triggerClick()
  *
  * @param string tag - label to attack to specific google url, used to access url
  * @param string url - url generated by google
  */
  setClickURL : function( tag, url )
  {
    this.clickURL[tag.toLowerCase()] = url;
  },

  /*
  * used to trigger click event using one of the passed in urls generated by google
  *
  * tag param comes from custom attribute data-google-tracker-tag added to html element used to handle click event
  * value of custom attribute data-google-tracker-tag must have a coorisponding, matching tag - key in associate array clickURL
  *
  * @param string tag - label linked to specific url generated by google
  * @param string newwindow - if 'true' then click will open url in a new window
  */
  triggerClick : function( tagIn, newwindow )
  {
    tag = tagIn.toLowerCase();
    if ( typeof newwindow == 'undefined' )
    {
      newwindow = true;
    }

    if ( newwindow != true && newwindow != false )
    {
      return false;
    }

    if ( typeof this.clickURL[tag] != 'undefined' )
    {
      if ( newwindow == true )
      {
        window.open( unescape( this.clickURL[tag] ) );
      }
      else 
      {
        window.location.href = unescape( this.clickURL[tag] );
      }
    }

    return false;
  },

  /*
  * Function links click action with google click urls for specificed html ids
  *
  * Function loops over array of ids, grabs the tag (label) that holds the url generated by google, then binds it to the click event of that element
  *
  * html element to be tied to click action must have two attribute, id and data-google-tracker-tag. data-google-tracker-newwindow optional
  *  - id 
  *  - data-google-tracker-tag - maps to url generated by google.  tag is key in associative array GoogleTracker.clickURLs. value of that array is the
  *                              url generated by google
  *  - data-google-tracker-newwindow  - should click open url in new window.  (string) 'true' | 'false' 
  *                                     if not present default action is to open in new window
  *
  * ex. of html element that would handle a click
  * <code>
  *   <div id="gt_click_1" data-google-tracker-tag="myb_1x1_pledgewall_promo" data-google-tracker-newwindow="true"></div>
  * </code>
  * 
  * @param object obj - obj.ids[] 
  *                     object w/ array of html ids
  *                     ex. obj.ids[] = 'gt_click_1'
  */
  Init : function( obj )
  {
    if ( typeof obj == 'undefined' )
    {
      return false;
    }

    if ( obj && "ids" in obj && typeof obj.ids == 'object' )
    {
      var id, tag, newwindow, val;
      for( var i = 0; i < obj.ids.length; i++ )
      {
        id  = obj.ids[i];
        newwindow = true;
        var $el = $(document.getElementById(id));
        tag = $el.attr('data-google-tracker-tag');
        val = $el.attr('data-google-tracker-newwindow');
        if ( tag ) 
        {
          newwindow = ( !val || val == "true" );
          
          $('#'+id).bind('click', function() {
            GoogleTracker.triggerClick( tag, newwindow );
          });
        }
      }
    }
    else 
    {
      return false;
    }

    return true;
  }

};
