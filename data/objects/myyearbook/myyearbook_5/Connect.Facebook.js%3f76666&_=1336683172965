Connect.Facebook=function(networkConfig){this.NAME='Facebook';var CONFIG_APPLICATION_ID='applicationId';var CONFIG_CALLBACKS='callbacks';var _0=this;var config={};var auth={};function init(networkConfig){if(typeof networkConfig.permissions!=='undefined'){networkConfig.permissions_string=networkConfig.permissions.join(',')}networkConfig.connectImage='btn_connecting_fb.gif';networkConfig.disconnectImage='btn_disconnecting_fb.gif';networkConfig.assetsLoaded=false;networkConfig.defaultCallbacks=true;_0.setConfig(networkConfig);config.applicationId=networkConfig.applicationId;config.callbacks=[['hasSharingEnabled',false]]}function getLoginStatus(loggedInCallback,loggedOutCallback){FB.getLoginStatus(function(response){if(checkResponse(response)===true){Connect.setConnectSession(_0.NAME,response.authResponse.userID);auth={connectId:response.authResponse.userID,accessToken:response.authResponse.accessToken,signedRequest:response.authResponse.signedRequest};loggedInCallback()}else{loggedOutCallback()}})}function login(loggedInCallback,loggedOutCallback){FB.login(function(response){if(checkResponse(response)===true){Connect.setConnectSession(_0.NAME,response.authResponse.userID);Connect.mybTrack('AllowPermissions');auth={connectId:response.authResponse.userID,accessToken:response.authResponse.accessToken,signedRequest:response.authResponse.signedRequest};loggedInCallback();return true}else{Connect.mybTrack('DenyPermissions');loggedOutCallback();return false}},{scope:config.permissions_string})}function checkResponse(response){if(typeof response.status!=='undefined'&&response.status==='unknown'){return false}return typeof response.authResponse!=='undefined'&&response.authResponse!==null}this.getConfig=function(key){if(typeof config[key]==='undefined'){throw new Error(_0.NAME+' config key \''+key+'\' is undefined.')}return config[key]};this.setConfig=function(configObject){for(var configKey in configObject){if(configKey===CONFIG_APPLICATION_ID||configKey===CONFIG_CALLBACKS){continue}config[configKey]=configObject[configKey]}};this.getFacebookPermissions=function(){try{return _0.getConfig('permissions_string')}catch(e){return'email,user_birthday'}};this.addCallback=function(callback,parameters){config.callbacks.push([callback,parameters])};this.clearCallbacks=function(){config.defaultCallbacks=false;config.callbacks=[]};this.loadDependencies=function(){if(typeof FB==='undefined'){if(Connect.language!==undefined){var lang=Connect.language}else{var langObj=$('html').attr('lang');var lang='en_US';if(langObj!==undefined&&langObj.length===5){lang=langObj.replace('-','_')}}var fbPath=window.location.protocol+'//connect.facebook.net/'+lang+'/all.js';return[fbPath]}return[]};this.login=function(statusOnly){Connect.setConnectSession(_0.NAME);if(typeof statusOnly!=='undefined'&&statusOnly===true){getLoginStatus(Connect.connectCallback,Connect.connectClose);return}if(typeof MyYearbook!=='undefined'&&typeof MyYearbook.URLs!=='undefined'){var channelURL=MyYearbook.URLs[MyYearbook.currentServiceName]+'xd_receiver.htm'}else{var channelURL=null}if($('#fb-root').size()===0){$('<div />').attr('id','fb-root').prependTo('body')}FB.init({appId:config.applicationId,status:true,cookie:true,xfbml:true,channelURL:channelURL,logging:false,oauth:true})};this.connectLoginStatus=function(response){if(checkResponse(response)===true){Connect.setConnectSession(_0.NAME,response.authResponse.userID);Connect.mybTrack('AllowPermissions');Connect.connectCallback();return true}else{Connect.mybTrack('DenyPermissions');Connect.cancelConnectCallback();return false}};this.logout=function(){if(typeof config.redirect!=='undefined'){FB.logout(function(response){window.location.href=config.redirect})}};this.connect=function(data){return _0.login()};this.connectCallback=function(){if(config.defaultCallbacks===true){var regCallback=function(){FB.api('/me?fields=id,first_name,last_name,birthday,gender,location,email,picture&type=large',function(response){_0.autoRegistration(response)});Connect.closePopup(Connect.POPUP_INTERSTITIAL)}}else{regCallback=Connect.connectClose}if(parseInt(auth.connectId,10)<=0){var loggedInCallback=function(){Connect.runCallbacks(_0.NAME,regCallback)};getLoginStatus(loggedInCallback,Connect.connectHalt)}else{Connect.runCallbacks(_0.NAME,regCallback)}};this.connectUserCallback=function(params,callback,data){if(data.response===true){window.location.reload()}else{Connect.error('You\'ve already connected this account twice today.  Please try again later.',_0.NAME);Connect.connectClose()}};this.disconnectCallback=function(data){window.location.reload()};this.connectFailCallback=function(data){};this.registrationCallback=function(data){data=Connect.connectData.Facebook;if(data===false||data===null){return false}if(typeof data!='object'){return false}$('#firstname').val(data.first_name);$('#lastname').val(data.last_name);if(typeof data.location!='undefined'){$('#zip').val(data.location.postalCode);if(data.location.regionId!='undefined'){Connect.updateCountry(data.location.countryId,data.location.regionId)}else{Connect.updateCountry(data.location.countryId)}}if(typeof data.birthday!='undefined'){$('#month').val(data.birthday.month);$('#day').val(parseInt(data.birthday.day,10));$('#year').val(parseInt(data.birthday.year,10))}if(typeof data.gender!='undefined'&&data.gender==2){$('#gender_female').attr('checked','');$('#gender_male').attr('checked','checked')}if(Connect.emailInUse===false){$('#quicksignupFrm input[name="email"]').val(data.email)}};this.autoRegistration=function(data){if(typeof data!=='object'){return false}Connect.setConnectedId(data.id,true,_0.NAME);if(typeof data.birthday=='string'&&data.birthday!=''){var bday=data.birthday.split('/');data.birthday={'month':bday[0],'day':parseInt(bday[1],10),'year':parseInt(bday[2],10)}}if(typeof data.gender!='undefined'&&data.gender==='male'){data.gender=2}else{data.gender=1}_0.getLocationData(data)};this.getLocationData=function(data){if(((window.SERVICE_NAME&&window.SERVICE_NAME!='home')||(window.SERVICE_NAME=='home'&&window.location.href.indexOf('http://home')!=-1))&&(window.SERVICE_NAME!='www')){var locationURL=BASE_URL+'locationDetect'}else{var locationURL=SITE_URL+'apps/locationDetect'}if(typeof data.location=='undefined'){locationURL+='?service=GeoIP&data=country,region,state,postalCode'}else{locationURL+='?location='+data.location.name+'&data=country,region,state,postalCode'}$.ajax({type:'get',dataType:'json',url:locationURL,success:function(response){data.location=response.locationData;Connect.connectData={'Facebook':data};_0.emailInUse(data)}})};this.setRegistrationTheme=function(){var registrationTheme=Connect.connectService+'Connect'+Connect.service.charAt(0).toUpperCase()+Connect.service.slice(1);if(Connect.registrationForm.useService===false){registrationTheme='Connect'+Connect.service.charAt(0).toUpperCase()+Connect.service.slice(1)}$.getScript(IMAGE_URL+'/JavaScript/apps/Registration/RegistrationHelper.js?'+cachebuster,function(){RegistrationHelper.setRegTheme(registrationTheme,false,'doRegistration')})};this.doRegistration=function(){var data=Connect.connectData.Facebook;if(typeof data.location.postalCode==='undefined'){data.location.postalCode='-1'}var regForm='<form id="facebookQuickRegistration" style="display:none;" action="'+MyYearbook.URLs.www+'?mysession=cmVnaXN0cmF0aW9uX3JlZ2lzdHJhdGlvbiZyZWZlcnJlcj0w" method="post">'+'<input type="hidden" name="firstname" value="'+data.first_name+'" />'+'<input type="hidden" name="lastname" value="'+data.last_name+'" />'+'<input type="hidden" name="gender" value="'+data.gender+'" />'+'<input type="hidden" name="month" value="'+data.birthday.month+'" />'+'<input type="hidden" name="day" value="'+data.birthday.day+'" />'+'<input type="hidden" name="year" value="'+data.birthday.year+'" />'+'<input type="hidden" name="country" value="'+data.location.countryId+'" />'+'<input type="hidden" name="zip" value="'+data.location.postalCode+'" />'+'<input type="hidden" name="email" value="'+data.email+'" />'+'<input type="hidden" name="connectId" value="'+data.id+'" />'+'<input type="hidden" name="terms" value="1" />'+'<input type="hidden" name="network" value="facebook" />'+'<input type="hidden" name="password" value="generate" />'+'<input type="submit" id="facebookQuickRegistrationSubmit" name="submit" value="facebookQuickRegistrationSubmit" style="display: none;" />';if(typeof data.location.regionId!='undefined'){regForm+='<input type="hidden" name="region" value="'+data.location.regionId+'" />'}regForm+='</form>';$('body').append(regForm);$('#facebookQuickRegistrationSubmit').trigger('click')};this.emailInUse=function(data){if(typeof data.email==='undefined'){Connect.serviceCallback(data);return false}$.ajax({type:'get',dataType:'json',url:Connect.url+'/emailcheck/'+data.email,success:function(emailCheck){if(emailCheck.success===true){if(emailCheck.emailInUse===true){Connect.emailInUse=true;Connect.regData=data;if(Connect.config.allowLogin===true){Connect.displayLogin('registration')}else{Connect.serviceCallback(data)}return true}else{if(typeof data.gender=='undefined'||typeof data.birthday=='undefined'){Connect.serviceCallback(data);return true}_0.setRegistrationTheme();return true}}callback();return true}})};this.hasSharingEnabled=function(params,callback){if(typeof service=='undefined'&&typeof Connect.connectService!='undefined'){service=Connect.connectService}else{callback()}$.ajax({type:'get',dataType:'json',url:Connect.url+'/hassharing/'+service.toLowerCase(),success:function(data){if(data.success!==true){callback()}else{Connect.appAuthorized=true;callback()}}})};this.setMemberData=function(response){FriendFinder.memberNetworkName=response.name};this.getFacebookFriends=function(callback){Connect.setConnectSession(_0.NAME);if(typeof callback!='function'){callback=_0.getMatchingFriends}var loggedInCallback=function(){FB.api('/me',function(response){if(typeof FriendFinder!='undefined'){_0.setMemberData(response)}FB.api('/me/friends',function(response){callback(response)})})};var loggedOutCallback=function(){login(function(){_0.getFacebookFriends(callback)},Connect.connectClose)};getLoginStatus(loggedInCallback,loggedOutCallback)};this.getMatchingFriends=function(friendsList){var data='';var i;$.ajax({type:'post',data:'data='+JSON.stringify(friendsList.data)+'&network=facebook&memberNetworkName='+FriendFinder.memberNetworkName+'&pageType='+FriendFinder.pageType,dataType:'json',url:MyYearbook.URLs.Friends+'friendfinder/getmatchingfriends',success:function(response){Connect.mergeFriendsToDom(response.matchingFriends,'facebook')}})};this.logInAndInviteFriendsInterstitial=function(){Connect.setConnectSession(_0.NAME);Connect.displayConnecting();var loggedInCallback=function(){_0.inviteFriendsFacebook('invite_friends','interstitial');Connect.connectClose()};var loggedOutCallback=function(){Connect.connectClose()};login(loggedInCallback,loggedOutCallback)};this.logInAndInviteFriendsManual=function(){Connect.setConnectSession(_0.NAME);Connect.displayConnecting();var loggedInCallback=function(){_0.inviteFriendsFacebook('invite_friends','button');Connect.connectClose()};var loggedOutCallback=function(){Connect.connectClose()};login(loggedInCallback,loggedOutCallback)};this.showConnectProfile=function(anchor){if(typeof auth.connectId!=='undefined'){FB.api('/me?fields=id,first_name,last_name,picture',function(data){var a=$(anchor);if(typeof data=='object'){var h=$('<div />').addClass('connectProfile');var c=$('<div />').attr('id','facebookHiddenConnectButton').css('display','none').html(a.html());c.appendTo(h);var p=$('<div />').addClass('columnContainer');$('<img />').attr('src',data.picture).appendTo(p);p.appendTo(h);var p=$('<div />').addClass('columnContainer');$('<p />').addClass('header').html(data.first_name+' '+data.last_name).appendTo(p);$('<p />').html('You have connected your Facebook account.').appendTo(p);$('<p />').addClass('disconnect').html('(<span id="facebookDisconnect" class="pseudolink">Disconnect</span>)').appendTo(p);h.append(p)}a.html(h);Connect.setConnectState(Connect.STATE_INIT);$('#facebookDisconnect').click(function(){var p=$(this).parents('span.facebookConnectButton');Connect.disconnectUser(_0.NAME,function(){Connect.closePopup(Connect.POPUP_LOADING,true);var connectButton=$('#facebookHiddenConnectButton').html();p.html(connectButton)})})})}};this.repositionDialog=function(timeout,retries){if(!window.SERVICE_NAME){return false}if(typeof timeout=='undefined'||parseInt(timeout,10)<=0){timeout=500}setTimeout(function(){if($('div.fb_pop_content_container').size()>0&&$('h2.fb_resetstyles').size()>0&&$('#RES_ID_fb_pop_dialog_table').size()>0&&$('#fb_dialog_cancel_button').size()>0){var winWidth=$(window).width();var fbWidth=f.width();var offset=(winWidth-fbWidth)/2;$('div.fb_pop_content_container').css('visibility','visible');$('h2.fb_resetstyles').css('visibility','visible');$('#fb_dialog_cancel_button').css('visibility','visible');$('#RES_ID_fb_pop_dialog_table').css('position','absolute');$('#RES_ID_fb_pop_dialog_table').css('left','225px');$('#RES_ID_fb_pop_dialog_table').css('visibility','visible');$('#connectLoading').remove()}else if(typeof retries!='undefined'&&retries!==false&&parseInt(retries,10)>0){_0.repositionDialog(timeout,parseInt(retries--,10))}},timeout)};this.inviteFriendsFacebook=function(redirectTo,trackingType){$.ajax({type:'get',dataType:'json',url:Connect.url+'/invite/facebook?'+(typeof redirectTo=='string'?'&redirect='+redirectTo:'')+(typeof trackingType=='string'?'&track='+trackingType:''),success:function(data){if(data.invite){Connect.closePopup(Connect.POPUP_LOADING);MyYearbook.BootLoader.add(IMAGE_URL+'/css/apps/Connect/ConnectFacebook.css?'+cachebuster,'css');var config={method:'fbml.dialog',width:760,fbml:data.invite};$('<div id="friendInvitePopup" />').appendTo('body').dragonDrop({'curtain':Connect.config.curtain,'curtainOpacity':'0.0'});if(jQuery.browser.msie){$('#friendInvitePopup').appendTo('body')}FB.ui(config,function(response){Connect.closePopup(Connect.POPUP_INTERSTITIAL);$('#friendInvitePopup').slayDragon(null,true)});$('div.fb_dialog_advanced, div.fb_dialog_legacy:last').prepend(data.header);$('iframe.FB_UI_Dialog').css({'border':'1px solid black','borderTop':'0px'});$('div.fb_dialog_legacy > span').hide();setTimeout(function(){$('div.fb_dialog_advanced').css({'background':'inherit','display':'block'});if($.browser.msie){$('div.fb_dialog_legacy:last').css({'border':'1px solid black','borderTop':'0px'});$('iframe.FB_UI_Dialog, div.fb_dialog_legacy:last').css({'width':'760px'});$('#facebookInviteBox').css({'border-width':'0px','border-top':'1px solid #000'})}else{$('iframe.FB_UI_Dialog').css({'border':'1px solid black','borderTop':'0px','width':'760px'})}},1000);$('.shareIncentive','#statusUpdateShareContainer').remove();$('.twitter','#statusUpdateShareContainer').remove();$('.myspace','#statusUpdateShareContainer').remove();$('.shareText','#statusUpdateShareContainer').html('Sharing on: <img class="connectPopup facebook" alt="" src="'+IMAGE_URL+'share/fb_mini.gif"><span class="gray"> (</span><a href="#" class="manageSharing">Manage</a><span class="gray">)</span>');$('.manageSharing','.shareText').click(function(){Share.getConnectPopup(false,$(this))})}else{Connect.connectState='init';Connect.closePopup(Connect.POPUP_LOADING);$('#dragonCurtain').remove();Connect.connectHalt()}}})};this.inviteFriendsFacebookConfirmation=function(){var content='<h1>Your Facebook invites have been sent!</h1><h2>Your friends will earn <span class="lunchMoney">L$100,000</span> for joining.</h2><img id="closePopup" src="'+IMAGE_URL+'/btn_close.gif" />';$('<div id="confirmationFacebookInvitationBox" />').appendTo('body').dragonDrop({"type":'window',"draggable":false,"centerOnScreen":true,"enableMinMax":false,"enableClose":true,"curtain":true,"width":560,"content":content});$('#closePopup','#confirmationFacebookInvitationBox').click(function(){$('#confirmationFacebookInvitationBox').slayDragon();$('#dragonCurtain').remove()})};init(networkConfig)};